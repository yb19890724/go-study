#### 值对象

通过对象属性值来识别的对象，它将多个相关属性组合为一个概念整体。在 DDD 中用来描述领域的特定方面，并且是一个没有标识符的对象，叫作值对象。

值对象本质上就是一个集。那这个集合里面有什么呢？若干个用于描述目的、具有整体概念和不可修改的属性。那这个集合存在的意义又是什么？在领域建模的过程中，值对象可以保证`属性归类的清晰和概念的完整性，避免属性零碎。


人员实体原本包括：姓名、年龄、性别以及人员所在的`省、市、县和街道等属性`。这样显示地址相关的属性就很零碎了对不对？现在，我们可以将“省、市、县和街道等属性”拿出来构成一个`“地址属性集合”`，这个集合就是值对象了。

1. 值对象的业务形态
值对象是 DDD 领域模型中的一个基础对象，它跟实体一样都来源于事件风暴所构建的领域模型，都包含了若干个属性，它与`实体一起构成聚合`。


本质上，实体是看得到、摸得着的实实在在的业务对象，实体具有业务属性、业务行为和业务逻辑。

而值对象只是若干个属性的集合，只有数据初始化操作和有限的不涉及修改数据的行为，基本不包含业务逻辑。

值对象的属性集虽然在物理上独立出来了，但在逻辑上它仍然是实体属性的一部分，用于描述实体的特征。


2.值对象的代码形态

值对象在代码中有这样两种形态。

- 如果值对象是单一属性，则直接定义为实体类的属性；
- 如果值对象是属性集合，则把它设计为 Class 类，Class 将具有整体概念的多个属性归集到属性集合，这样的值对象没有 ID，会被实体整体引用。


```gotemplate
type product struct {
    id      uint     //值对象 人员唯一id
    name    string   //单一属性值对象
    age     uint     //单一属性值对象
    address Address  //属性集值对象，被实体引用
}

type address struct{
    proince string
    city    string
    conuty  string
    street  string
}

```

3.值对象的运行形态

实体实例化后的 DO 对象的业务属性和业务行为非常丰富，但值对象实例化的对象则相对简单和乏味。除了值对象数据`初始化`和`整体替换的行为外`，其它业务行为就很少了。

值对象嵌入实体，两种数据格式(两种方法)，分别是属性嵌入的方式和序列化大对象方式。

属性嵌入：引用单一属性的值对象或只有一条记录的多属性值对象的实体，可以采用属性嵌入的方式嵌入。

大对象序列化：引用一条或多条记录的多属性值对象的实体，可以采用序列化大对象的方式嵌入

```json
{
    "address":{
        "proince": "",
        "city":    "",
        "conuty" : "",
        "street" : ""
    }
}
```

4.值对象的数据库形态

DDD 引入值对象是希望实现从`“数据建模为中心”`向`“领域建模为中心”`转变，减少数据库表的数量和表与表之间复杂的依赖关系，尽可能地简化数据库设计，提升数据库性能。

###### 如何理解用值对象来简化数据库设计呢？

传统的数据建模大多是根据数据库范式设计的，每一个数据库表对应一个实体，每一个实体的属性值用单独的一列来存储，一个实体主表会对应 N 个实体从表。
而值对象在数据库持久化方面简化了设计，它的数据库设计大多采用非数据库范式，`值对象的属性值`和`实体对象的属性值`保存在同一个数据库实体表中。

- 例:

方案：

   还是基于上述人员和地址那个场景，实体和数据模型设计通常有两种解决方案
- 第一是把地址值对象的所有属性都放到人员实体表中，创建人员实体，创建人员数据表；
- 第二是创建人员和地址两个实体，同时创建人员和地址两张表。

问题：
- 第一个方案会破坏地址的业务涵义和概念完整性，
- 第二个方案增加了不必要的实体和表，需要处理多个实体和表的关系，从而增加了数据库设计的复杂性。

###### 那到底应该怎样设计，才能让业务含义清楚，同时又不让数据库变得复杂呢？

两个方案的优势，扬长避短。
在领域建模时，我们可以把地址作为值对象，人员作为实体，这样就可以保留地址的业务涵义和概念完整性。
而在数据建模时，我们可以将地址的属性值嵌入人员实体数据库表中，只创建人员数据库表。这样既可以兼顾业务含义和表达，又不增加数据库的复杂度。


对象就是通过这种方式，简化了数据库设计.

总结一下就是：在领域建模时，我们可以将部分对象设计为值对象，保留对象的业务涵义，同时又减少了实体的数量；在数据建模时，我们可以将值对象嵌入实体，减少实体表的数量，简化数据库设计。

5.值对象的优势和局限

优势:
> 它的优势是可以简化数据库设计，提升数据库性能。但如果值对象使用不当，它的优势就会很快变成劣势。

局限:
> 大对象的方法简化了数据库设计，减少了实体表的数量，可以简单、清晰地表达业务概念。这种设计方式虽然降低了数据库设计的复杂度，但却无法满足基于值对象的快速查询，会导致搜索值对象属性值变得异常困难。

总结:
> 值对象采用属性嵌入的方法提升了数据库的性能，但如果实体引用的值对象过多，则会导致实体堆积一堆缺乏概念完整性的属性，这样值对象就会失去业务涵义，操作起来也不方便。

###### 实体和值对象的关系

实体和值对象是微服务底层的`最基础的对象`，一起实现实体最基本的核心领域逻辑。


    很多 DDD 专家在这些场景下，其实也很难判断到底将领域对象设计成实体还是值对象？
    可以说，值对象在某些场景下有很好的价值，但是并不是所有的场景都适合值对象。
    你需要根据团队的设计和开发习惯，以及上面的优势和局限分析，选择最适合的方法。
    
    
###### DDD 引入值对象还有一个重要的原因，就是到底领域建模优先还是数据建模优先？

> DDD 提倡从领域模型设计出发，而不是先设计数据模型。

前面讲过了，传统的数据模型设计通常是一个表对应一个实体，一个主表关联多个从表，当实体表太多的时候就很容易陷入无穷无尽的复杂的数据库设计，`领域模型`就很容易被`数据模型`绑架。可以说，值对象的诞生，在一定程度上，和实体是`互补`的。

请用自己的话总结下，实体和值对象的主要区别是什么？

①两者都经过属性聚类形成，实体有唯一性，值对象没有。在本文案例的限界上下文中，人员有唯一性，一旦某个人员被系统纳入管理，它就被赋予了在事件、流程和操作中被唯一识别的能力，而值对象没有也不必具备唯一性。  
②实体着重唯一性和延续性，不在意属性的变化，属性全变了，它还是原来那个它；值对象着重描述性，对属性的变化很敏感，属性变了，它就不是那个它了。  
③战略上的思考框架稳定不变，战术上的模型设计却灵活多变，实体和值对象也有可能随着系统业务关注点的不同而更换位置。比如，如果换一个特殊的限界上下文，这个上下文更关注地址，而不那么关注与这个地址产生联系的人员，那么就应该把地址设计成实体，而把人员设计成值对象。