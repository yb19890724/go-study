#### DDD 有两把利器，那就是它的战略设计和战术设计方法。

中台是抽象出来的`业务模型`，微服务是`业务模型`的`系统实现`，DDD 作为方法论可以同时指导中台业务建模和微服务建设，三者相辅相成，完美结合。

> DDD 有两把利器，那就是它的战略设计和战术设计方法。

中台在企业架构上更多偏向业务模型，形成中台的过程实际上也是业务领域不断细分的过程。
在这个过程中我们会将同类通用的业务能力进行`聚合`和`业务重构`，再根据`限界上下文`和`业务内聚`的原则建立`领域模型`。而 DDD 的战略设计最擅长的就是`领域建模`。

那在中台完成领域建模后，我们就需要通过微服务来完成系统建设。此时，DDD 的`战术设计`又恰好可以与`微服务的设计`完美结合。可以说，中台和微服务正是 DDD 实战的最佳场景。


###### DDD 的本质

中台的本质其实就是提炼各个业务板块的共同需求，进行业务和系统抽象，形成通用的可复用的业务模型，打造成组件化产品，供前台部门使用。
前台要做什么业务，需要什么资源，可以直接找中台，不需要每次都去改动自己的底层。

###### DDD、中台和微服务的协作模式

传统企业和阿里中台战略的差异，那实际上更多的企业还是会聚焦在传统企业中台建设的模式，也就是将通用能力与核心能力全部中台化，以满足不同渠道核心业务能力的复用，那么接下来我们就还是把重点放在传统企业上。

传统企业可以将需要共享的公共能力进行领域建模，建设可共享的`通用中台`。
除此之外，传统企业还会将核心能力进行领域建模，建设面向不同渠道的可复用的`核心中台`。

> 而这里的通用中台和核心中台都属于我们上一讲讲到的业务中台的范畴。

DDD 的子域分为核心域、通用域和支撑域。划分这几个子域的主要目的是为了确定战略资源的投入，一般来说战略投入的重点是核心域，因此后面我们就可以暂时不严格区分支撑域和通用域了。


领域、中台以及微服务虽然属于不同层面的东西，但我们还是可以将他们分解对照，整理出来它们之间的关系。
你看下面这张图，我是从 DDD 领域建模和中台建设这两个不同的视角对同一个企业的业务架构进行分析。

![Image text](https://static001.geekbang.org/resource/image/c6/df/c647561ff910f97b8500b75de70281df.png)

如果将企业内整个业务域作为一个问题域的话，企业内的所有业务就是一个领域。

- DDD 视角来看，子域可分为核心域、通用域和支撑域。
- 中台建设的视角来看，业务域细分后的业务中台，可分为`核心中台`和`通用中台`。

从领域功能属性和重要性对照来看，通用中台对应 DDD 的通用域和支撑域，核心中台对应 DDD 的核心域。
从领域的功能范围来看，子域与中台是一致的。领域模型所在的`限界上下文`对应`微服务`。
建立了这个映射关系，我们就可以用 DDD 来进行中台业务建模了。


`我们这里还是以保险领域为例`。
保险域的业务中台分为两类：
第一类是提供保险核心业务能力的核心中台（比如营销、承保和理赔等业务）；
第二类是支撑核心业务流程完成保险全流程的通用中台（比如订单、支付、客户和用户等）。

根据 DDD 首先要建立通用语言的原则，在将 DDD 的方法引入中台设计时，我们要先建立中台和 DDD 的通用语言。这里的子域与中台是一致的，那我们就可以将子域统一为中台。


中台通过事件风暴可以进一步细分，最终完成业务领域建模。
中台业务领域的功能不同，限界上下文的数量和大小就会不一样，领域模型也会不一样。

当完成业务建模后，我们就可以采用 DDD 战术设计，设计出聚合、实体、领域事件、领域服务以及应用服务等领域对象，再利用分层架构模型完成微服务的设计。

> 就是 DDD、中台和微服务在应用过程中的协作模式。


中台业务抽象的过程就是业务建模的过程，对应 DDD 的战略设计。
系统抽象的过程就是微服务的建设过程，对应 DDD 的战术设计。
下面我们就结合 DDD 领域建模的方法，讲一下中台业务建模的过程。

- 第一步：按照业务流程（通常适用于核心域）或者功能属性、集合（通常适用于通用域或支撑域），将业务域细分为多个中台，再根据功能属性或重要性归类到核心中台或通用中台。
核心中台设计时要考虑核心竞争力，通用中台要站在企业高度考虑共享和复用能力。

- 第二步：选取中台，根据用例、业务场景或用户旅程完成事件风暴，找出实体、聚合和限界上下文。依次进行领域分解，建立领域模型。

由于不同中台独立建模，某些领域对象或功能可能会重复出现在其它领域模型中，也有可能本该是同一个聚合的领域对象或功能，却分散在其它的中台里，这样会导致领域模型不完整或者业务不内聚。
这里先不要着急，这一步我们只需要初步确定主领域模型就可以了，在第三步中我们还会提炼并重组这些领域对象。

- 第三步：以主领域模型为基础，扫描其它中台领域模型，检查并确定是否存在重复或者需要重组的领域对象、功能，提炼并重构主领域模型，完成最终的领域模型设计。

- 第四步：选择其它主领域模型重复第三步，直到所有主领域模型完成比对和重构。

- 第五步：基于领域模型完成微服务设计，完成系统落地。

![Image text](https://static001.geekbang.org/resource/image/3c/47/3caae85ef680eb7cbc2ffb5c6a603f47.png)

结合上面这张图，你可以大致了解到 DDD 中台设计的过程。
DDD 战略设计包括上述的第一步到第四步，主要为：业务域分解为中台，对中台归类，完成领域建模，建立中台业务模型。
DDD 战术设计是第五步，领域模型映射为微服务，完成中台建设。

![Image text](https://static001.geekbang.org/resource/image/45/71/45de1af6a4b5dd6cf54921ff9f422571.png)

那么如果还是以保险领域为例的话，完成领域建模后，里面的数据我们就可以填上了。
这里我选取了通用中台的用户、客户和订单三个中台来做示例。
客户中台提炼出了两个领域模型：客户信息和客户视图模型。用户中台提炼出了三个领域模型：用户管理、登录认证和权限模型。订单中台提炼出了订单模型。